---
import Project from "../components/project.astro";
import projects from "../data/projects.json";
const categories = Array.from(new Set(projects.map((p) => p.category)));
---

<select id="categoryFilter">
    <option value="all">All Categories</option>
    {categories.map((category) => (
            <option value={category}>{category}</option>
    ))}
</select>

<div id="project-list">
    {projects.map((project) => (
            <div class="project-item" data-category={project.category}>
                <Project
                        visible={project.visible}
                        title={project.title}
                        projectTags={project.projectTags}
                        description={project.description}
                        image={project.image}
                        collaborations={project.collaborations}
                        links={project.links}
                />
            </div>
    ))}
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const selectedCategory = urlParams.get('category') || 'all';

        // Set the dropdown to match the URL category (if any)
        const filterDropdown = document.getElementById("categoryFilter");
        filterDropdown.value = selectedCategory;

        // Filter projects based on the selected category
        document.querySelectorAll(".project-item").forEach((item) => {
            const projectCategory = item.dataset.category;
            item.style.display =
                selectedCategory === "all" || projectCategory === selectedCategory
                    ? "block"
                    : "none";
        });

        // Update project visibility when the dropdown changes
        filterDropdown.addEventListener("change", function () {
            const selectedCategory = filterDropdown.value;
            const newUrl = new URL(window.location);
            newUrl.searchParams.set("category", selectedCategory);
            window.history.pushState({}, "", newUrl);

            document.querySelectorAll(".project-item").forEach((item) => {
                item.style.display =
                    selectedCategory === "all" || item.dataset.category === selectedCategory
                        ? "block"
                        : "none";
            });
        });
    });
</script>